define("frame/page_control",["base_package","ua"],function(e,t){function n(){var e=location.href,t=v.length;if(t>1){var n=v[t-2];return"forward"!=p&&n==e?!0:!1}return!1}function i(e,t,n,i){var o,s,r=this,l="400ms",_="400ms",d="400ms",p="ease";switch(z&&c.isAndroid&&(n="none"),"function"==typeof t.page_before_show&&t.page_before_show.call(r,t,g),n){case"slide":i?(o="slideinfromleft",s="slideoutfromright"):(o="slideinfromright",s="slideoutfromleft"),animation_timing_function=p,animation_duration=l;break;case"slideup":i?(o="slideupinfromtop",s="slideupoutfrombottom"):(o="slideupinfrombottom",s="slideupoutfromtop"),animation_timing_function=p,animation_duration=_;break;case"fade":o="fadein",s="fadeout",animation_timing_function=p,animation_duration=d;break;default:o="none",s="none",animation_timing_function=p,animation_duration="10ms"}if(k=!0,o){var u=t.el;if(w=t,u.style.webkitAnimationDuration=animation_duration,u.style.webkitAnimationTimingFunction=animation_timing_function,u.style.visibility="visible",u.style.webkitAnimationName=o,e){var h=e.el;x=e,h.style.webkitAnimationDuration=animation_duration,h.style.webkitAnimationTimingFunction=animation_timing_function,h.style.webkitAnimationName=s}else k=!1;setTimeout(function(){"function"==typeof w.page_back_show&&y&&w.page_back_show.call(r,w,g),"function"==typeof w.page_show&&w.page_show.call(r,w,g),a()},parseInt(animation_duration))}}function a(){var e=x.el;w.el,e&&(d(e).css({top:"-3000px"}),1==x.dom_not_cache&&y&&x&&x.remove()),k=!1,u=null,p=null,y=null}var o,s,r,l,_=e("backbone"),d=e("zepto"),c=e("ua"),p=null,u=null,h={},f=[],m=null,g=[],v=[],b={},w={},x={},y=null,k=!1,$=!1,z=!0,j=_.Router.extend({}),q=new j;t.init=function(e,t){var n=this,t=t||{};s=t.default_index_route||"",r=t.before_route||"",l=t.after_route||"",o=e,q.route("","",function(){n.navigate_to_page(s)})},t.route_start=function(){_.history.start()},t.navigate_to_page=function(e,t){k||(b=t,p="forward",q.navigate(e,{trigger:!0,replace:!1}))},t.back=function(){if(!k){if(1>=f.length)return""!=s&&this.navigate_to_page(s),!1;p="backward",window.history.back()}},t.page_history=function(){return v},t.window_change_page_triger=function(){"function"==typeof w.window_change&&w.window_change.call(this,w)},t.return_current_page_view=function(){return w},t.lock_page=function(){$=!0},t.unlock_page=function(){$=!1},t.page_lock_status=function(){return $},t.page_transit_status=function(){return k},t.add_page=function(e){var t=this,a=e.route||{};for(key in a)q.route(key,a[key],function(a,s,_){g=[],g.push(a),g.push(s),g.push(_);var c=location.href;"function"==typeof r&&r.call(t);var p=!1,p=d(o).find('[page-url="'+c+'"]').length;if(y=n()){var u=f.pop(),w=f[f.length-1];if(p>0){var x=u.transition_type;i(u,w,x,!0),setTimeout(function(){w.$el.css({top:"0px",zIndex:1e4})},10),m=w}v.pop()}else{var w=h[c];if(p>0&&!w.ignore_exist)w.$el.css({top:"0px"});else{var k=e.new_page_entity(),$=k.view();console.log($),$.$el.attr("page-url",c),$.$el.css({visibility:"hidden",top:"0px",zIndex:1e4}),d(o).append($.$el),w=$,h[c]=$,"function"==typeof $.page_init&&$.page_init.call(t,$,g,b)}u=m;var x=w.transition_type;i(u,w,x,!1),m=w,f.push(w),v.push(c)}"function"==typeof l&&l.call(t)})}});